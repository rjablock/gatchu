<div class="container">
  <div class="row">
    <div class="offset-1 col-11">

      <!--エラーメッセージ-->
      <%= render 'layouts/errors', obj: @user %>

      <div class="content-box", style="margin: 100px 0;">

        <h5 class="h4 ml-5 pt-4 font-weight-bold">プロフィール編集</h5>

        <div class="mt-4 px-3 form-group">
          <%= form_with model: [:public, @user], url: user_path do |f| %>
            <!--会員編集フォーム-->
            <table class="table table-borderless">
              <tr>
                <td class="align-middle font-weight-bold">ユーザー名</td>
                <td><%= f.text_field :name, placeholder: "ユーザー名を入力してください", class: "form-control col-8" %></td>
              </tr>
              <tr>
                <td class="align-middle font-weight-bold">プロフィール画像</td>
                <td>
                  <%= f.file_field :profile_image, accept: "image/png, image/jpeg" %><br>
                  <!--プレビュー表示-->
                  <img class="mt-2" id="image-preview" alt="プレビュー" style="max-width: 150px; border: solid thin lightgray; border-radius: 5px;">
                </td>
              </tr>
              <tr>
                <td class="align-middle font-weight-bold">自己紹介</td>
                <td>
                  <%= f.text_area :introduction, placeholder: "自己紹介を入力してください", class: "form-control", style: "height: 120px;" %>
                  <div id="introduction-count" class="mt-1 text-right text-muted" style="font-size: 14px;">0 / 100文字</div>
                </td>
              </tr>
              <tr>
                <td class="align-middle font-weight-bold">性別</td>
                <td>
                  <%= f.radio_button :gender, "not_answer" %>
                  <%= label_tag :gender_not_answer, "回答しない" %>
                  <%= f.radio_button :gender, "male", class: "ml-3" %>
                  <%= label_tag :gender_male, "男性" %>
                  <%= f.radio_button :gender, "female", class: "ml-3" %>
                  <%= label_tag :gender_female, "女性" %>
                </td>
              </tr>
              <tr>
                <td class="align-middle font-weight-bold">年齢</td>
                <td><%= f.select :age, User.ages.keys.map { |k| [I18n.t("enums.user.age.#{k}"), k] }, { include_blank: false }, { class: "form-control col-6"} %></td>
              </tr>
              <tr>
                <td class="align-middle font-weight-bold">学習歴</td>
                <td><%= f.select :study_background, User.study_backgrounds.keys.map { |k| [I18n.t("enums.user.study_background.#{k}"), k] }, { include_blank: false }, { class: "form-control col-6"} %></td>
              </tr>
              <tr>
                <td class="align-middle font-weight-bold">居住地</td>
                <td><%= f.select :living_area, User.living_areas.keys.map { |k| [I18n.t("enums.user.living_area.#{k}"), k] }, { include_blank: false }, { class: "form-control col-6" } %></td>
              </tr>
              <tr>
                <td class="pt-4 font-weight-bold">メールアドレス</td>
                <td><%= f.text_field :email, placeholder: "メールアドレス", class: "form-control col-6" %></td>
              </tr>
            </table>
            <!--変更を保存ボタン-->
            <div class="text-center">
              <%= f.submit "変更内容を保存", class: "mt-2 btn btn-success btn-lg" %>
            </div>
          <% end %>
        </div>

      </div>

    </div>
  </div>
</div>

<!--画像ファイルが選択された際に画像のプレビューを表示-->
<script>
  $(document).ready(function() {
    var imagePreview = $("#image-preview");
    var fileInput = $("#user_profile_image");

    imagePreview.hide();

    fileInput.on("change", function(event) {
      var file = event.target.files[0];

      if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.attr("src", e.target.result).show();
        }
        reader.readAsDataURL(file);
      } else {
        imagePreview.hide();
      }
    });
  });
</script>

<!--文字数カウンター-->
<script>
  $(document).ready(function() {
    const textField = $("#user_introduction");
    const introductionCount = $("#introduction-count");

    textField.on("input", function() {
      const count = textField.val().length;
      introductionCount.text(count + " / 100文字");
    });
  });
</script>