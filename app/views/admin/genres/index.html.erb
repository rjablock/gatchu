<div class="container my-5">
  <div class="row">
    <div class="offset-1 col-11">

      <div class="row">
        <div class="col-3">
           <h5 class="term-title ml-2 font-weight-bold">ジャンル管理</h5>
        </div>

        <!--ジャンル新規登録欄（ポップアップ表示）-->
        <div class="col-10 mx-auto form-group" id="new-genre-form"
             style="display: none; position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0, 0, 0, 0.6); padding: 30px; z-index: 99999; border-radius: 10px;">
          <table class="table table-borderless">
              <tr>
                <td>
                  <%= form_with model: @genre, url: admin_genres_path, html: { class: "form-inline" } do |f| %>
                    <%= f.text_field :name, name: "genre[name]", placeholder: "新規ジャンル名（最大6文字）", class: "col-8 form-control mr-2" %>
                    <%= f.submit "ジャンル作成", class:"col-3 btn btn-primary" %><br>
                    <p class="text-white pt-3"> ※作成をやめる場合は画面外をクリック</p>
                  <% end %>
                </td>
              </tr>
          </table>
        </div>

        <!--ジャンル作成ボタン-->
        <div class="offset-6 col-3 mt-3">
          <div class="py-2 px-3 btn btn-primary" id="new-genre-button">
             <i class="fa-solid fa-tags fa-lg"></i> ジャンル作成
          </div>
        </div>
      </div>

      <!--各列カラム名-->
      <table class="table table-colored mt-3">
        <thead>
          <tr>
            <th>ジャンルID</th>
            <th>ジャンル名</th>
            <th>記事の投稿数</th>
            <th></th>
          </tr>
        </thead>

        <!--ジャンル一覧-->
        <% @genres.each do |genre| %>
          <tbody>
            <tr>
              <td class="align-middle"><%= genre.id %></td>
              <td class="align-middle"><%= genre.name %></td>
              <td class="align-middle"><%= genre.posts.count %></td>
              <td><div class="py-2 px-3 btn btn-success btn-sm">編集</div></td>
            </tr>
          </tbody>
        <% end %>

      </table>

      <!--ページネーションの設定-->
      <div class="row">
        <div class="mt-2 mx-auto">
          <%= paginate @genres, theme: 'bootstrap-5' %>
        </div>
      </div>

    </div>
  </div>
</div>

<!--「ジャンル作成」ボタン押下時に発火-->
<script>
  // HTMLドキュメントが読み込まれた後に実行される関数
  $(document).ready(function() {
    var newGenreButton = $("#new-genre-button");
    var newGenreForm = $("#new-genre-form");

    // ジャンル作成ボタンがクリックされたとき
    newGenreButton.on("click", function() {
      event.stopPropagation(); // ここでクリックイベントの伝播を停止しなければ以下の`outsideClick`関数と同時に発火してしまい、想定と異なる挙動を生む
      slideDown(newGenreForm);
    });

    // 引数で指定された要素をスライドダウンさせ、出現させる処理
    function slideDown(element) {
      element.fadeIn(300);
      $(document).on("click", outsideClick); // 表示中は`outsideClick`関数を有効にする
    }

    // ポップアップ表示画面外をクリックすることでスライドアップさせる
    function outsideClick(event) {
      if (!$(event.target).closest(newGenreForm).length) { //「クリックされた要素が内部である場合には数値が返され、それ以外の場合は0となる」の否定形
        slideUp(newGenreForm);
      }
    }

    //引数で指定された要素をスライドアップさせ、引っ込ませる処理
    function slideUp(element) {
      element.fadeOut(300);
      $(document).off("click", outsideClick); // 非表示中は`outsideClick`関数を無効にする
    }
  });
</script>